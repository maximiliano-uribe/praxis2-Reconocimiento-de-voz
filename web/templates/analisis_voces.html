{% extends "base_acceso.html" %}
{% block content %}

<h2>游댉 An치lisis de Voces Registradas</h2>

<p>Selecciona una voz para generar sus gr치ficas:</p>

<select id="selectorVoces" style="padding:8px; font-size:16px;"></select>
<br><br>

<button onclick="generarGraficas()" style="padding:10px 20px; font-size:16px;">
    游늵 Generar Gr치ficas
</button>

<hr>

<div id="resultados" style="margin-top:20px;">
    <h3>Gr치fica de Onda</h3>
    <img id="imgOnda" style="max-width:80%; display:none;">

    <h3>Gr치fica FFT</h3>
    <img id="imgFFT" style="max-width:80%; display:none;">

    <h3>Espectrograma</h3>
    <img id="imgSpec" style="max-width:80%; display:none;">
</div>

<script>
// Cargar voces al cargar la p치gina
fetch('/listar_voces')
    .then(r => r.json())
    .then(voces => {
        let select = document.getElementById("selectorVoces");
        voces.forEach(v => {
            let op = document.createElement("option");
            op.value = v;
            op.textContent = v;
            select.appendChild(op);
        });
    });

// Generar gr치ficas
function generarGraficas() {
    let archivo = document.getElementById("selectorVoces").value;

    fetch('/graficar_voz', {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({archivo: archivo})
    })
    .then(r => r.json())
    .then(data => {
        if (data.error) {
            alert(data.error);
            return;
        }
        document.getElementById("imgOnda").src = "/static/" + data.onda;
        document.getElementById("imgFFT").src = "/static/" + data.fft;
        document.getElementById("imgSpec").src = "/static/" + data.spec;

        document.getElementById("imgOnda").style.display = "block";
        document.getElementById("imgFFT").style.display = "block";
        document.getElementById("imgSpec").style.display = "block";
    });
}
</script>

{% endblock %}
